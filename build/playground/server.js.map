{"version":3,"file":"server.js","sources":["../../ab59d23a83a52ece383e3cbe4a6089","../../src/server.js","../../playground/server.js"],"sourcesContent":["export default '/home/zane/dev/obdb/playground'","const body_parser = require('body-parser')\nconst fs = require('fs-extra')\nconst uuid = require('uuid/v4')\nconst store = {}\n\nexport default function attach({dir, app}) {\n  app.use(body_parser.json())\n  app.use(body_parser.text())\n  app.post('/db/:field', (req, res) => {\n    const id = uuid()\n    const { field } = req.params\n    store[field][id] = req.body\n    write_data(dir, field)\n      .then(() => res.end(id))\n      .catch(() => res.status(500).end('Unable to write data - server error'))\n  })\n  app.get('/db/:field', (req, res) => {\n    const { field } = req.params\n    if (!store[field])\n      get_data(dir, field)\n        .then(data => res.end(JSON.stringify(store[field] = data)))\n        .catch(console.error)\n    else res.end(JSON.stringify(store[field]))\n  })\n  app.delete('/db/:field/:id', (req, res) => {\n    const { field, id } = req.params\n    if (store[field][req.params.id]) delete store[field][req.params.id]\n    write_data(dir, field)\n      .then(() => res.end(id))\n      .catch(() => res.status(500).end('Unable to write data - server error'))\n  })\n  app.put('/db/:field/:id', (req, res) => {\n    const { field, id } = req.params\n    store[field][id] = req.body\n    write_data(dir, field)\n      .then(() => res.end(id))\n      .catch(() => res.status(500).end('Unable to write data - server error'))\n  })\n}\n\nexport function get_data(dir, field) {\n  const path = dir + '/' + field + '.json'\n  return fs.readJson(path)\n    .catch(err => {\n      if (err.code ===  'ENOENT')\n        fs.writeJson(path, {})\n      return {}\n    })\n}\n\nexport function write_data(dir, field) {\n  const path = dir + '/' + field + '.json'\n  return fs.ensureFile(path)\n    .then(() => fs.writeJson(path, store[field]))\n}\n\n","import db from '../src/server'\n\nconst express = require('express')\nconst path = require('path')\n\nconst app = express()\n\ndb({\n  app,\n  dir: __dirname + '/data',\n})\napp.use(express.static(path.resolve(__dirname, '../build/playground/public')))\napp.use(express.static(__dirname + '/static'))\napp.use((req, res) => res.sendFile(__dirname + '/static/index.html'))\n\napp.listen(3000, () => console.log('Listening on 3000'))\n"],"names":["db"],"mappings":"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"}